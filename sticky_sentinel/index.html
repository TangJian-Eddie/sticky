<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div>
      <div class="container">
        <div class="sticky_sentinel sticky_sentinel-top"></div>
        <div class="sticky title" id="sticky1">title</div>
        <div>
          Lorem ipsum dolor sit amet, consectetur adipisicing elit. Asperiores
          vitae, eveniet, delectus fugiat odit atque tempora enim eaque facere,
          sed impedit eum ea porro amet quas laborum. Ratione officiis minima
          maiores quos, porro cumque consequuntur, natus recusandae quam
          provident praesentium voluptatibus beatae eveniet? Eligendi asperiores
          numquam nesciunt eius qui nam ea vitae autem aperiam, corrupti
          voluptate quod fugit sapiente, rerum nihil est illo? Vitae consectetur
          vero et, quisquam aspernatur veritatis, accusamus quod ipsam deserunt,
          doloribus libero cum? Fugit soluta sunt veniam dignissimos, quisquam
          assumenda tenetur tempore molestiae quam cupiditate reiciendis,
          voluptatibus nulla sequi asperiores, pariatur aliquam esse minima
          doloribus nesciunt!
        </div>
        <div class="sticky_sentinel sticky_sentinel-bottom"></div>
      </div>
      <div class="container">
        <div class="sticky_sentinel sticky_sentinel-top"></div>
        <div class="sticky title" id="sticky2">title</div>
        <div>
          Lorem ipsum dolor sit amet, consectetur adipisicing elit. Asperiores
          vitae, eveniet, delectus fugiat odit atque tempora enim eaque facere,
          sed impedit eum ea porro amet quas laborum. Ratione officiis minima
          maiores quos, porro cumque consequuntur, natus recusandae quam
          provident praesentium voluptatibus beatae eveniet? Eligendi asperiores
          numquam nesciunt eius qui nam ea vitae autem aperiam, corrupti
          voluptate quod fugit sapiente, rerum nihil est illo? Vitae consectetur
          vero et, quisquam aspernatur veritatis, accusamus quod ipsam deserunt,
          doloribus libero cum? Fugit soluta sunt veniam dignissimos, quisquam
          assumenda tenetur tempore molestiae quam cupiditate reiciendis,
          voluptatibus nulla sequi asperiores, pariatur aliquam esse minima
          doloribus nesciunt!
        </div>
        <div class="sticky_sentinel sticky_sentinel-bottom"></div>
      </div>
      <div class="container">
        <div class="sticky_sentinel sticky_sentinel-top"></div>
        <div class="sticky title" id="sticky3">title</div>
        <div>
          Lorem ipsum dolor sit amet, consectetur adipisicing elit. Asperiores
          vitae, eveniet, delectus fugiat odit atque tempora enim eaque facere,
          sed impedit eum ea porro amet quas laborum. Ratione officiis minima
          maiores quos, porro cumque consequuntur, natus recusandae quam
          provident praesentium voluptatibus beatae eveniet? Eligendi asperiores
          numquam nesciunt eius qui nam ea vitae autem aperiam, corrupti
          voluptate quod fugit sapiente, rerum nihil est illo? Vitae consectetur
          vero et, quisquam aspernatur veritatis, accusamus quod ipsam deserunt,
          doloribus libero cum? Fugit soluta sunt veniam dignissimos, quisquam
          assumenda tenetur tempore molestiae quam cupiditate reiciendis,
          voluptatibus nulla sequi asperiores, pariatur aliquam esse minima
          doloribus nesciunt!
        </div>
        <div class="sticky_sentinel sticky_sentinel-bottom"></div>
      </div>
      <div class="container">
        <div class="sticky_sentinel sticky_sentinel-top"></div>
        <div class="sticky title" id="sticky4">title</div>
        <div>
          Lorem ipsum dolor sit amet, consectetur adipisicing elit. Asperiores
          vitae, eveniet, delectus fugiat odit atque tempora enim eaque facere,
          sed impedit eum ea porro amet quas laborum. Ratione officiis minima
          maiores quos, porro cumque consequuntur, natus recusandae quam
          provident praesentium voluptatibus beatae eveniet? Eligendi asperiores
          numquam nesciunt eius qui nam ea vitae autem aperiam, corrupti
          voluptate quod fugit sapiente, rerum nihil est illo? Vitae consectetur
          vero et, quisquam aspernatur veritatis, accusamus quod ipsam deserunt,
          doloribus libero cum? Fugit soluta sunt veniam dignissimos, quisquam
          assumenda tenetur tempore molestiae quam cupiditate reiciendis,
          voluptatibus nulla sequi asperiores, pariatur aliquam esse minima
          doloribus nesciunt!
        </div>
        <div class="sticky_sentinel sticky_sentinel-bottom"></div>
      </div>
      <div class="container">
        <div class="sticky_sentinel sticky_sentinel-top"></div>
        <div class="sticky title" id="sticky5">title</div>
        <div>
          Lorem ipsum dolor sit amet, consectetur adipisicing elit. Asperiores
          vitae, eveniet, delectus fugiat odit atque tempora enim eaque facere,
          sed impedit eum ea porro amet quas laborum. Ratione officiis minima
          maiores quos, porro cumque consequuntur, natus recusandae quam
          provident praesentium voluptatibus beatae eveniet? Eligendi asperiores
          numquam nesciunt eius qui nam ea vitae autem aperiam, corrupti
          voluptate quod fugit sapiente, rerum nihil est illo? Vitae consectetur
          vero et, quisquam aspernatur veritatis, accusamus quod ipsam deserunt,
          doloribus libero cum? Fugit soluta sunt veniam dignissimos, quisquam
          assumenda tenetur tempore molestiae quam cupiditate reiciendis,
          voluptatibus nulla sequi asperiores, pariatur aliquam esse minima
          doloribus nesciunt!
        </div>
        <div class="sticky_sentinel sticky_sentinel-bottom"></div>
      </div>
    </div>
  </body>
</html>
<style>
  * {
    margin: 0;
    padding: 0;
  }
  .container {
    position: relative;
    padding: 20px;
    margin: 20px;
    border: 1px solid #ccc;
    border-radius: 20px;
  }
  .sticky {
    position: sticky;
    top: 0;
  }
  .title {
    background-color: blue;
  }
  .sticky_sentinel {
    background: yellow;
    position: absolute;
    left: 0;
    right: 0; /* needs dimensions */
    visibility: hidden;
  }
  .sticky_sentinel-top {
    height: 20px;
    top: 0;
  }
  .sticky_sentinel-bottom {
    bottom: 0;
    height: 20px;
  }
  .container.isSticky .sticky {
    background-color: burlywood;
  }
</style>
<script>
  function observeHeader() {
    const observer = new IntersectionObserver(
      (records) => {
        for (const record of records) {
          const record = records[0];
          const { boundingClientRect, rootBounds } = record;
          if (boundingClientRect.bottom <= rootBounds.top) {
            // 向下滚动 – 当头部哨兵穿过容器的顶部时，头部进入粘性模式。
            triggerEvent(true, record.target.parentElement);
          }
          if (
            boundingClientRect.bottom > rootBounds.top &&
            boundingClientRect.bottom < rootBounds.bottom
          ) {
            // 向上滚动 – 当顶部哨兵从上面滚回可见区域的时候，头部离开粘性模式。
            triggerEvent(false, record.target.parentElement);
          }
        }
      },
      {
        threshold: [0],
      }
    );
    for (let item of document.getElementsByClassName("sticky_sentinel-top")) {
      observer.observe(item);
    }
  }
  function observeFooters() {
    const observer = new IntersectionObserver(
      (records) => {
        for (const record of records) {
          console.log(record);
          const { boundingClientRect, rootBounds, intersectionRatio } = record;
          if (boundingClientRect.top <= rootBounds.top) {
            // 向下滚动 – 当底部哨兵穿过容器顶部时，头部离开粘性模式。
            triggerEvent(false, record.target.parentElement);
          }
          if (
            boundingClientRect.bottom >= rootBounds.top &&
            boundingClientRect.top <= rootBounds.top
          ) {
            // 向上滚动 – 当底部哨兵从上方回到可见区域的时候，头部进入粘性模式
            triggerEvent(true, record.target.parentElement);
          }
        }
      },
      {
        threshold: [0],
      }
    );
    for (let item of document.getElementsByClassName(
      "sticky_sentinel-bottom"
    )) {
      observer.observe(item);
    }
  }
  function triggerEvent(status, target) {
    const evt = new CustomEvent("sticky-change", {
      detail: { status, target },
    });
    document.dispatchEvent(evt);
  }
  document.addEventListener("sticky-change", (e) => {
    // Update sticking header title.
    const { target, status } = e.detail;
    target.classList.toggle("isSticky", status);
  });
  observeFooters();
  observeHeader();
</script>
